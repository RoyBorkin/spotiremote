<!DOCTYPE html>
<html>
	
<!-- Mirrored from freekb.es/spotify/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 28 May 2025 14:55:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
		<meta charset="utf-8">
		<link rel="manifest" href="manifest.json" />
		<title>Spotify Remote Web Controller</title>
		<meta name="description" content="A web controller for Spotify, targeted for Android Go, because I've heard the official Spotify application runs like shit and sometimes you just wanna control what's playing without getting up from bed or something">
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="theme-color" content="#1DB954" />
		<meta name="application-name" content="Spotify Remote Web Controller">
		<meta name="og:image" content="icon.png" />
		<meta property="og:image" content="icon.png" />
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
		<link rel="icon" type="image/ico" href="favicon.ico" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-title" content="Spotify Remote Web Controller" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
		<meta name="browsermode" content="application">
		<meta name="screen-orientation" content="portrait">

		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<style>html, body {
	display: block;
	padding: 0px;
	margin: 0px;
	background-color: #191414;
	color: #FFFFFF;
	font-family: Roboto, Verdana, Arial, Sans-Serif;
	font-size: 16px;
	cursor: default;
	height: 100%;
	width: 100%;
	user-select: none;
}

a, a:visited {
	color: #1DB954;
	transition: color .15s ease;
}

a:hover {
	color: #1ed760;
}

.page {
	display: none;
	box-sizing: border-box;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	height: 100%;
	width: 100%;
	margin: 0px;
	padding: 0px;
}

.page.active {
	display: block;
}

.bigbutton {
	display: block;
	margin: 24px auto 8px auto;
	font-size: 14px;
	line-height: 1.5;
	border-radius: 500px;
	padding: 7px 35px 7px;
	color: #ffffff;
	background-color: #2ebd59;
	transition: background-color .15s ease, border-color .15s ease, color .15s ease;
	border-width: 0;
	letter-spacing: 1.2px;
	min-width: 130px;
	text-transform: uppercase;
	white-space: normal;
	border: 1px solid;
	border-color: #29a84f;
	text-align: center;
	-ms-touch-action: manipulation;
	touch-action: manipulation;
	cursor: pointer;
	background-image: none;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
	text-decoration: none;
	-webkit-box-sizing: border-box;
	box-sizing: border-box;
	font-weight: 500;
}

.bigbutton:focus {
	outline: 0;
}

.bigbutton:hover {
	background-color: #1ed760;
	border-color: #1d7738;
	outline: 0;
}

.bigbutton:active {
	background-color: #2ebd59;
	box-shadow: none;
	outline: 0;
}

#signinpage {
	text-align: center;
	padding: 96px 16px;
}

h1 {
	margin: 8px 0px 16px 0px;
}

#welcome {
	margin-bottom: 54px;
}

p {
	margin: 8px 0px;
}

#signinbtn {
	margin-top: 24px;
}

.disclaimer {
	margin-top: 14px;
	font-size: small;
	color: #555555;
}

.disclaimer.footer {
	display: block;
	position: fixed;
	bottom: 0px;
	left: 0px;
	right: 0px;
	padding: 8px;
}

.disclaimer a {
	color: inherit !important;
}

.disclaimer a:hover {
	color: #757575 !important;
}

.spinner {
	display: inline-block;
	width: 60px;
	height: 60px;
	padding: 0px;
	box-sizing: border-box;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	
	border: 7px solid rgba(0,0,0,0);
	border-top: 7px solid;
	border-top-color: #1DB954;
	transition: border-top-color 1s;
	border-radius: 30px;
	animation: spin 0.8s linear infinite;
}

@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

#playerpage {
	background-color: #15161A;
}

#topbar {
	display: block;
	height: 42px;
	padding: 8px 12px 0px 12px;
	white-space: nowrap;
}

#playing-from-holder {
	text-align: center;
	height: inherit;
	padding: 4px 42px 6px 42px;
	overflow: hidden;
	white-space: nowrap;
}

#playing-from {
	text-transform: uppercase;
	font-size: 10px;
	letter-spacing: 1px;
	text-overflow: ellipsis;
	overflow: hidden;
}

#playing-from-name {
	font-size: 13px;
	font-weight: bold;
	text-overflow: ellipsis;
	overflow: hidden;
}

#art-holder {
	margin: 24px;
	text-align: center;
}

#artwork {
	display: inline-block;
	width: 100%;
	object-fit: cover;
	background: #000000;
	pointer-events: none;
}

#below-art-holder {
	display: block;
	position: fixed;
	bottom: 0px;
	left: 0px;
	right: 0px;
	padding: 18px 24px 28px 24px;
}

#metadata-holder-holder {
	
}

#metadata-holder {
	display: inline-block;
	vertical-align: middle;
	padding: 10px 0px 10px 8px;
	width: 80%;
	width: calc(100% - 62px);
	width: -webkit-calc(100% - 62px);
	width: -moz-calc(100% - 62px);
	overflow: hidden;
	white-space: nowrap;
}

#title, #artist {
	text-overflow: ellipsis;
	overflow: hidden;
}

#title {
	font-size: 19px;
	font-weight: bold;
}

#artist {
	color: #B3B3B3;
	font-size: 17px;
}

#like-button {
	display: inline-block;
	vertical-align: middle;
	margin-left: 8px;
	width: 40px;
	height: 40px;
	font-size: 24px;
}

#seekbar-holder {

}

/* seekbar */
#progressbar-outer {
	width: 100%;
	height: 4px;
	border-radius: 1px;
	padding: 0px;
	padding-top: 14px;
	padding-bottom: 14px;
	margin: 0px;
	white-space: nowrap;
	background-color: rgba(0,0,0,0);
	position: relative;
	cursor: default;
}

#progressbar-outer .progressbar-inner {
	width: 0%;
	height: inherit;
	border-radius: inherit;
	position: absolute;
	left: 0;
	transition: 0.5s;
	transition-timing-function: linear;
}

#progressbar-outer #barbackground {
	width: 100%;
	background-color: #353942;
	z-index: 1;
}

#progressbar-outer #progressbar {
	background-color: #FFFFFF;
	z-index: 3;
}

#progressbar-outer #bufferbar {
	background-color: rgba(255,255,255,0.2);
	z-index: 2;
	transition-timing-function: ease;
}

#progressbar:after {
	content: '';
	display: inline-block;
	width: 8px;
	height: 8px;
	border-radius: 4px;
	background-color: #FFFFFF;
	position: absolute;
	position: absolute;
	right: -4px;
	top: -2px;

	animation: progresshover 0.1s 1 alternate ease-in-out;
	animation-fill-mode: backwards;
}

#progressbar.hovering:after {
	width: 10px;
	height: 10px;
	border-radius: 5px;
	
	right: -5px;
	top: -3px;
	
	animation: progresshover 0.1s 1 alternate ease-in-out;
	animation-fill-mode: forwards;
}

@keyframes progresshover {
	from {
		
	}
	to {
		width: 16px;
		height: 16px;
		border-radius: 8px;
		right: -6px;
		top: -6px;
	}
}

#times {
	color: #B3B3B3;
	font-size: 13px;
	white-space: nowrap;
	margin-top: -9px;
	pointer-events: none;
}

#times > span {
	display: inline-block;
	width: 50%;
	vertical-align: middle;
}

#playback-time {
	text-align: left;
}

#duration-time {
	text-align: right;
}

button {
	display: inline-block;
	vertical-align: middle;
	border: none;
	background: none;
	outline: none;
	color: #FFFFFF;
	cursor: pointer;
}

button[disabled] {
	opacity: 0.3;
	cursor: default;
}

#controls-holder {
	text-align: center;
	white-space: nowrap;
}

.main-button {
	font-size: 76px;
	width: 88px;
	height: 88px;
	margin: 0px -12px;
	border-radius: 44px;
}

.skip-button {
	font-size: 48px;
	width: 60px;
	height: 60px;
	margin: 0px 8px;
}

.side-button {
	font-size: 20px;
	width: 50px;
	height: 50px;
}

#bottombar {
	white-space: nowrap;
}

.bar-button {
	width: 40px;
	height: 40px;
	font-size: 24px;
}

#devices-button {
	color: #B3B3B3;
}

#devices-button::after {
	display: inline-block;
	vertical-align: middle;
	margin-left: 4px;
	text-align: left;
	font-family: Roboto, Verdana, Arial, Sans-Serif;
	font-size: 13px;
	content: attr(data-curdevice);
	max-width: 170px;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

#queue-button {
	float: right;
}

#listeningon-holder {
	padding: 56px 16px 24px 16px;
	height: 48px;
}

#listeningon-title {
	font-weight: bold;
	font-size: 21px;
	margin: 2px 0px;
}

#listeningon-icon {
	float: left;
	color: #1DB954;
	width: 48px;
	height: 48px;
	padding: 9px;
	box-sizing: border-box;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	font-size: 30px;
	text-align: center;
	margin-right: 16px;
}

#listeningon {
	color: #1DB954;
}

#devicelist-holder, #discoverlist-holder {
	padding: 16px;
}

#discoverlist-holder {
	max-width: 500px;
	margin: 0 auto;
}

.selectdevice {
	font-weight: bold;
}

#devicelist, #discoverlist {
	text-align: left;
	padding: 0px;
	margin: 10px 0px;
	list-style-type: none;
}

.devicelist-item {
	display: list-item;
	padding: 12px 0px;
	margin: 0px;
	cursor: pointer;
}

.devicelist-icon {
	display: inline-block;
	font-size: 30px;
	width: 48px;
	text-align: center;
	margin-right: 16px;
	vertical-align: middle;
}

.devicelist-name {
	display: inline-block;
	vertical-align: middle;
}

#volumebar-holder {
	position: absolute;
	bottom: 8px;
	left: 0px;
	right: 0px;
	padding: 8px;
}

#volumebar-icon {
	display: inline-block;
	vertical-align: middle;
	font-size: 24px;
	text-align: center;
	padding: 8px 0px;
	width: 40px;
}

#volumebar {
	display: inline-block;
	vertical-align: middle;
	appearance: none;
	-webkit-appearance: none;
	-moz-appearance: none;
	width: 80%;
	width: calc(100% - 64px);
	width: -webkit-calc(100% - 64px);
	width: -moz-calc(100% - 64px);
	height: 4px;
	border-radius: 2px;
	outline: none;
	background-color: #353942;
	background: linear-gradient(to right, #1DB954 0%, #1DB954 50%, #353942 50%, #353942 100%);
}

#volumebar::-webkit-slider-thumb {
	-webkit-appearance: none;
	appearance: none;
	width: 14px;
	height: 14px;
	border-radius: 7px;
	background: #FFFFFF;
	cursor: pointer;
}

#volumebar::-moz-range-thumb {
	width: 14px;
	height: 14px;
	border-radius: 7px;
	background: #FFFFFF;
	cursor: pointer;
}

.close-button {
	position: absolute;
	top: 8px;
	right: 8px;
	width: 40px;
	height: 40px;
	font-size: 32px;
	z-index: 10;
}

#library-button {
	position: absolute;
	top: 6px;
	left: 6px;
	width: 40px;
	height: 40px;
	font-size: 32px;
	z-index: 10;
}

#search-button {
	position: absolute;
	top: 6px;
	right: 6px;
	width: 40px;
	height: 40px;
	font-size: 25px;
	z-index: 10;
}

#discoverpage {
	text-align: center;
}

h2 {
	padding: 32px 16px 16px 16px;
	margin: 0px;
	font-size: 24px;
	font-weight: bold;
}

#discover-disclaimer {
	margin-bottom: 64px;
	padding: 16px;
}

.dotted {
	position: relative;
}

.dotted::before {
	content: '';
	display: block;
	position: absolute;
	left: 50%;
	left: calc(50% - 2px);
	left: -webkit-calc(50% - 2px);
	left: -moz-calc(50% - 2px);
	bottom: 0;
	width: 4px;
	height: 4px;
	border-radius: 2px;
	background: #1DB954;
}

.side-button.dotted::before {
	bottom: 7px;
}

.list-header {
	display: block;
	padding-top: 14px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	position: absolute;
	top: 0px;
	left: 0px;
	width: 80%;
	width: calc(100% - 66px);
	width: -webkit-calc(100% - 66px);
	width: -moz-calc(100% - 66px);
	z-index: 2;
}

.list-header::before {
	content: '';
	position: fixed;
	top: 0px;
	left: 0px;
	right: 0px;
	background: linear-gradient(#191414, #191414, rgba(0,0,0,0));
	width: 200%;
	height: 60px;
	z-index: -1;
}

#queuepage, #librarypage, #search-page {
	overflow-x: hidden;
	overflow-y: auto;
}

#queue-holder, #library-holder, #search-holder {
	padding-top: 60px;
}

.tracklist {
	text-align: left;
	padding: 0px;
	margin: 10px 0px;
	list-style-type: none;
}

.queue-item {
	display: list-item;
	height: 48px;
	padding: 8px 12px;
	margin: 0px;
	cursor: pointer;
	white-space: nowrap;
}

.queue-item.divider {
	display: list-item;
	height: auto;
	padding: 8px 4px 8px 60px;
	margin: 24px 8px 8px 8px;
	cursor: default;
	white-space: nowrap;
	font-weight: bold;
	font-size: 18px;
	border-bottom: solid 1px #353942;
}

.queue-item-cover, .queue-item-metadata {
	display: inline-block;
	vertical-align: top;
}

.queue-item-cover {
	width: 48px;
	height: 48px;
	margin-right: 9px;
}

.queue-item-cover img {
	object-fit: cover;
	width: inherit;
	height: inherit;
}

.queue-item-cover span {
	display: inline-block;
	text-align: center;
	width: 100%;
	line-height: 48px;
	color: #B3B3B3;
	font-size: 13px;
}

.queue-item-metadata {
	padding: 6px 0px;
	width: 75%;
	width: calc(100% - 60px);
	width: -webkit-calc(100% - 60px);
	width: -moz-calc(100% - 60px);
}

.queue-item-name {
	font-size: 15px;
	text-overflow: ellipsis;
	overflow: hidden;
}

.queue-item-artist {
	color: #B3B3B3;
	font-size: 13px;
	text-overflow: ellipsis;
	overflow: hidden;
}

#searchbar-wrapper {
	padding: 12px 24px;
}

#searchbar {
	display: block;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	width: 100%;
	margin: 0px;
	padding: 4px 12px;
	border: none;
	outline: 0;
	font-size: 17px;
	height: 34px;
	border-radius: 17px;
}</style>
		<script>var state = 465;</script>
		<script>function getParameterByName(name, url) {
	if (!url) url = window.location.href;
	name = name.replace(/[\[\]]/g, "\\$&");
	var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)", "i"),
	results = regex.exec(url);
	if (!results) return null;
	if (!results[2]) return '';
	return decodeURIComponent(results[2].replace(/\+/g, " "));
}

function stripTags(text) {
	var tmp = document.createElement("div");
	tmp.innerHTML = text;
	return tmp.textContent || tmp.innerText;
}

function getCookie(name) {
	var re = new RegExp(name + "=([^;]+)");
	var value = re.exec(document.cookie);
	return (value != null) ? unescape(value[1]) : null;
}

function setCookie(name, value) {
	document.cookie = name + " = " + value + "; expires=Mon, 14 Sep 2025 18:49:22 GMT; path=/";
}

function formatSeconds(seconds) {
	var s = Math.floor(seconds % 60);
	var m = Math.floor((seconds / 60) % 60);
	var u = Math.floor(((seconds / 60) / 60 ) % 60);
	if (u > 0 && m < 10) {
		m = '0' + m;
	}
	if (s < 10) {
		s = '0' + s;
	}
	if (u < 1) {
		return (m + ':' + s);
	}
	else if (u >= 1) {
		return (u + ':' + m + ':' + s);
	}
}

function getDeviceIcon(type) {
	switch (type) {
		case "smartphone":
			return "&#xe32c;";
		case "computer":
			return "&#xe30a;";
		case "speaker":
		case "avr":
			return "&#xe32d;";
		case "tv":
		case "stb":
			return "&#xe333;"
		case "gameconsole":
			return "&#xe30f;";
		case "castvideo":
		case "castaudio":
			return "&#xe307;";
		case "automobile":
			return "&#xe531;";
		case "audiodongle":
			return "&#xe60f;";
		case "unknown":
		default:
			return "&#xe337;";
	}
}</script>
		<script type="application/javascript" src="../../ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script>var pageHandler = {
	shown: "loadingpage",

	showPage: function(pageId) {
		pageHandler.hidePage();
		$("#"+pageId).addClass("active");
		pageHandler.shown = pageId;
		if (pageId == "playerpage") {
			spotifyHandler.fixArtSize();
		}
		if (pageId == "searchpage") {
			document.getElementById("searchbar").focus();
		}
	},
	
	hidePage: function() {
		var pages = document.getElementsByClassName("page");
		for (var i = 0; i < pages.length; i++)
		{
			$(pages[i]).removeClass("active");
		}
		pageHandler.shown = null;
	}
};</script>
		<script type="application/javascript" src="vibrant.min.js"></script>
		<script type="application/javascript" src="spotify-web-api.js"></script>
		<script>var spotifyHandler = {
	scopes: ["user-read-private", "user-read-currently-playing", "user-read-playback-state", "user-modify-playback-state", "user-read-recently-played", "user-library-read", "user-library-modify", "playlist-read-private", "playlist-read-collaborative"],
	accessToken: null,
	expires: -1,
	api: new SpotifyWebApi(),
	dom: {},
	progress: 0,
	duration: 0,
	lastTrackId: "null2",
	lastQueueId: "null2",
	lastPlaybackStatus: {},

	signIn: function() {
		window.location.href = "https://accounts.spotify.com/authorize?client_id=44219fb334174bc6b2c634d8f9e4f6eb&response_type=token&redirect_uri="+encodeURIComponent(window.location.origin + window.location.pathname)+"&scope="+spotifyHandler.scopes.join("%20")+"&show_dialog=false&state="+state;
	},

	checkAccessToken: function() {
		if ((new Date().getTime() + 25000) >= spotifyHandler.expires) {
			console.warn("Spotify Access Token has expired! Refreshing page to refresh the access token...");
			window.location.href = window.location.origin + window.location.pathname;
		}
	},

	setCurrentlyPlaying: function() {
		if (!document.hidden) {
			spotifyHandler.api.getMyCurrentPlaybackState({}, function(err, data) {
				if (err) {
					console.error(err);
				}
				else if (data != undefined && typeof data != "string" && data.item != null) {
					// console.log(data);
					spotifyHandler.lastPlaybackStatus = data;
					if (pageHandler.shown == "discoverpage") {
						pageHandler.showPage("playerpage");
					}
					if (data.item.id == null) {
						data.item.id = data.item.uri.split(":").pop();
					}
					if (data.item.id != spotifyHandler.lastTrackId) {
						spotifyHandler.lastTrackId = data.item.id;
						if (data.item.album.images.length > 0) {
							spotifyHandler.dom.artwork.src = data.item.album.images[0].url;
						}
						else {
							spotifyHandler.dom.artwork.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
						}
						spotifyHandler.dom.title.innerHTML = stripTags(data.item.name);
						var tempArtists = "";
						for (var i = 0; i < data.item.artists.length; i++) {
							tempArtists += data.item.artists[i].name;
							if (i != data.item.artists.length - 1) {
								tempArtists += ", ";
							}
						}
						spotifyHandler.dom.artist.innerHTML = stripTags(tempArtists);
						if (data.context != null) {
							switch (data.context.type) {
								case "playlist": {
									spotifyHandler.api.getPlaylist(data.context.uri.split(":").pop(), {fields: "name,id"}, function(err, data) {
										if (err) {
											console.error(err);
										}
										else {
											// console.log(data);
											spotifyHandler.dom.playingFrom.innerHTML = "Playing from playlist";
											spotifyHandler.dom.playingFromName.innerHTML = stripTags(data.name);
											spotifyHandler.dom.contextName.innerHTML = stripTags(data.name);
											spotifyHandler.fillQueue("playlist", data.id);
										}
									});
									break;
								}
								case "album": {
									spotifyHandler.api.getAlbum(data.context.uri.split(":").pop(), {}, function(err, data) {
										if (err) {
											console.error(err);
										}
										else {
											// console.log(data);
											spotifyHandler.dom.playingFrom.innerHTML = "Playing from album";
											spotifyHandler.dom.playingFromName.innerHTML = stripTags(data.name);
											spotifyHandler.dom.contextName.innerHTML = stripTags(data.name);
											spotifyHandler.fillQueue("album", data.id);
										}
									});
									break;
								}
								case "artist": {
									spotifyHandler.api.getArtist(data.context.uri.split(":").pop(), {}, function(err, data) {
										if (err) {
											console.error(err);
										}
										else {
											// console.log(data);
											spotifyHandler.dom.playingFrom.innerHTML = "Playing from artist";
											spotifyHandler.dom.playingFromName.innerHTML = stripTags(data.name);
											spotifyHandler.dom.contextName.innerHTML = stripTags(data.name);
											spotifyHandler.fillQueue("artist", data.id);
										}
									});
									break;
								}
								default: {
									spotifyHandler.dom.playingFrom.innerHTML = "";
									spotifyHandler.dom.playingFromName.innerHTML = "";
									spotifyHandler.dom.contextName.innerHTML = "";
									spotifyHandler.fillQueue(null, null);
									break;
								}
							}
						}
						else {
							spotifyHandler.dom.playingFrom.innerHTML = "Playing from Your Library";
							spotifyHandler.dom.playingFromName.innerHTML = "Liked Songs";
							spotifyHandler.dom.contextName.innerHTML = "Liked Songs";
							spotifyHandler.fillQueue("library", "library");
							console.log("No context for currently playing track, assuming library is being played");
						}
						if ('mediaSession' in navigator)
						{
							navigator.mediaSession.playbackState = "playing";
							var tempArtwork = [];
							for (var i = 0; i < data.item.album.images.length; i++) {
								tempArtwork[i] = {
									sizes: data.item.album.images[i].width+"x"+data.item.album.images[i].height,
									src: data.item.album.images[i].url,
									type: "image/jpeg"
								};
							}
							navigator.mediaSession.metadata = new MediaMetadata({
								title: data.item.name,
								artist: tempArtists,
								artwork: tempArtwork
							});
						}
						spotifyHandler.duration = Math.floor(data.item.duration_ms / 1000);
					}
					spotifyHandler.progress = Math.floor(data.progress_ms / 1000);
					if (!progressBar.hovering) {
						progressBar.setValue((data.progress_ms / data.item.duration_ms) * 100);
						spotifyHandler.updateTimes(spotifyHandler.progress, spotifyHandler.duration);
					}

					if (data.device.volume_percent != null) {
						spotifyHandler.dom.volumebar.disabled = false;
						spotifyHandler.setVolume(data.device.volume_percent, true);
					}
					else {
						spotifyHandler.dom.volumebar.disabled = true;
					}
					
					if (data.is_playing) {
						spotifyHandler.dom.playPauseButton.title = "Pause";
						spotifyHandler.dom.playPauseButton.innerHTML = "&#xe035;";
					}
					else {
						spotifyHandler.dom.playPauseButton.title = "Play";
						spotifyHandler.dom.playPauseButton.innerHTML = "&#xe038;";
					}

					if (!data.item.is_local) {
						spotifyHandler.dom.likeButton.disabled = false;
						spotifyHandler.dom.likeButton.style.display = "inline-block";
						spotifyHandler.api.containsMySavedTracks([data.item.id], {}, function(err, data) {
							if (err) {
								console.error(err);
							}
							else if (data[0]) {
								spotifyHandler.dom.likeButton.innerHTML = "&#xe87d;";
								spotifyHandler.dom.likeButton.style.color = "#1DB954";
								spotifyHandler.dom.likeButton.title = "Remove from liked songs";
								spotifyHandler.dom.likeButton.setAttribute("data-liked", "true");
							}
							else {
								spotifyHandler.dom.likeButton.innerHTML = "&#xe87e;";
								spotifyHandler.dom.likeButton.style.color = null;
								spotifyHandler.dom.likeButton.title = "Add to liked songs";
								spotifyHandler.dom.likeButton.setAttribute("data-liked", "false");
							}
						});
					}
					else {
						spotifyHandler.dom.likeButton.disabled = true;
						spotifyHandler.dom.likeButton.style.display = "none";
					}

					if (data.shuffle_state) {
						spotifyHandler.dom.shuffleButton.style.color = "#1DB954";
						spotifyHandler.dom.shuffleButton.className = "material-icons side-button dotted";
					}
					else {
						spotifyHandler.dom.shuffleButton.style.color = null;
						spotifyHandler.dom.shuffleButton.className = "material-icons side-button";
					}

					switch (data.repeat_state) {
						case "context":
							spotifyHandler.dom.repeatButton.style.color = "#1DB954";
							spotifyHandler.dom.repeatButton.innerHTML = "&#xe040;";
							spotifyHandler.dom.repeatButton.className = "material-icons side-button dotted";
							break;
						case "track":
							spotifyHandler.dom.repeatButton.style.color = "#1DB954";
							spotifyHandler.dom.repeatButton.innerHTML = "&#xe041;";
							spotifyHandler.dom.repeatButton.className = "material-icons side-button dotted";
							break;
						default:
						case "off":
							spotifyHandler.dom.repeatButton.style.color = null;
							spotifyHandler.dom.repeatButton.innerHTML = "&#xe040;";
							spotifyHandler.dom.repeatButton.className = "material-icons side-button";
							break;
					}
				}
				else {
					console.log("No instances of Spotify found to control.");
					if (spotifyHandler.lastTrackId != "null2") {
						setTimeout(function() {
							spotifyHandler.refreshDevices();
						}, 500);
					}
					if (pageHandler.shown != "discoverpage") {
						pageHandler.showPage("discoverpage");
					}
				}
			});
		}
	},

	fixArtSize: function() {
		var maxHeight = document.getElementById("below-art-holder").offsetTop - 42 - 48;
		var maxWidth = window.innerWidth - 48;
		if (maxHeight < maxWidth) {
			spotifyHandler.dom.artwork.style.width = maxHeight + "px";
		}
		else {
			spotifyHandler.dom.artwork.style.width = maxWidth + "px";
		}
	},

	updateTimes: function(prog, dur) {
		spotifyHandler.dom.playbackTime.innerHTML = formatSeconds(prog);
		spotifyHandler.dom.durationTime.innerHTML = formatSeconds(dur);
	},

	refreshDevices: function() {
		if (!document.hidden) {
			spotifyHandler.api.getMyDevices(function(err, data) {
				if (err) {
					console.error(err);
					spotifyHandler.dom.deviceList.innerHTML = "";
				}
				else {
					var tempList = "";
					var tempListDis = "";
					for (var i = 0; i < data.devices.length; i++) {
						if (data.devices[i].is_active) {
							spotifyHandler.dom.listeningOn.innerHTML = stripTags(data.devices[i].name);
							spotifyHandler.dom.listeningOnIcon.innerHTML = getDeviceIcon(data.devices[i].type.toLowerCase());
							if (data.devices.length > 1) {
								spotifyHandler.dom.devicesButton.setAttribute("data-curdevice", stripTags(data.devices[i].name));
							}
							else {
								spotifyHandler.dom.devicesButton.setAttribute("data-curdevice", "");
							}
						}
						else {
							tempList += '<li class="devicelist-item" onclick="spotifyHandler.transferPlayback(\''+data.devices[i].id+'\')"><span class="devicelist-icon material-icons">'+getDeviceIcon(data.devices[i].type.toLowerCase())+'</span><span class="devicelist-name">'+data.devices[i].name+'</span></li>';
						}
						tempListDis += '<li class="devicelist-item" onclick="spotifyHandler.startPlaySession(\''+data.devices[i].id+'\')"><span class="devicelist-icon material-icons">'+getDeviceIcon(data.devices[i].type.toLowerCase())+'</span><span class="devicelist-name">'+data.devices[i].name+'</span></li>';
					}
					spotifyHandler.dom.deviceList.innerHTML = tempList;
					spotifyHandler.dom.discoverList.innerHTML = tempListDis;
					if (data.devices.length > 1) {
						spotifyHandler.dom.deviceListHolder.style.display = "block";
						spotifyHandler.dom.devicesButton.className = "material-icons bar-button dotted";
					}
					else {
						spotifyHandler.dom.deviceListHolder.style.display = "none";
						spotifyHandler.dom.devicesButton.className = "material-icons bar-button";
					}
					if (data.devices.length > 0) {
						spotifyHandler.dom.discoverSpinner.style.display = "none";
						spotifyHandler.dom.discoverListHolder.style.display = null;
					}
					else {
						spotifyHandler.dom.discoverSpinner.style.display = null;
						spotifyHandler.dom.discoverListHolder.style.display = "none";
					}
				}
			});
		}
	},

	setVolume: function(newVolume, volumebarOnly) {
		spotifyHandler.dom.volumebar.style.background = 'linear-gradient(to right, #1DB954 0%, #1DB954 '+newVolume+'%, #353942 '+newVolume+'%, #353942 100%)';
		if (spotifyHandler.dom.volumebar.value != newVolume && !changingVolume) {
			spotifyHandler.dom.volumebar.value = newVolume;
		}
		if (!volumebarOnly) {
			spotifyHandler.api.setVolume(newVolume, {});
		}
	},

	transferringPlayback: false,
	transferPlayback: function(deviceId) {
		if (!spotifyHandler.transferringPlayback) {
			spotifyHandler.transferringPlayback = true;
			spotifyHandler.api.transferMyPlayback([deviceId], {}, function(err, data) {
				if (err) {
					console.error(err);
					spotifyHandler.transferringPlayback = false;
				}
				else {
					console.log("Moved playback");
					setTimeout(function() {
						spotifyHandler.refreshDevices();
						spotifyHandler.transferringPlayback = false;
					}, 500);
				}
			});
		}
	},

	fetchingQueue: false,
	queueTotal: undefined,
	queueOffset: 0,
	fillQueue: function(type, id) {
		if (id != null)
		{
			if (spotifyHandler.lastQueueId != id) {
				spotifyHandler.dom.queueButton.disabled = true;
				spotifyHandler.lastQueueId = id;
				spotifyHandler.lastQueueType = type;
				spotifyHandler.queueOffset = 0;
				spotifyHandler.queueTotal = undefined;
				spotifyHandler.dom.queue.innerHTML = "";
				spotifyHandler.fetchQueueTracks(type, id, 0);
			}
			else {
				console.log("Queue already loaded for id " + id);
			}
		}
		else {
			spotifyHandler.lastQueueId = null;
			spotifyHandler.lastQueueType = null;
			spotifyHandler.dom.queue.innerHTML = "";
			spotifyHandler.fetchQueueTracks(type, id, 0);
		}
	},

	fetchQueueTracks: function(type, id, offset) {
		if (spotifyHandler.fetchingQueue != true) {
			if (type == "album") {
				spotifyHandler.fetchingQueue = true;
				spotifyHandler.api.getAlbumTracks(id, {offset: offset}, spotifyHandler.handleFetchedTracks);
			}
			else if (type == "playlist") {
				spotifyHandler.fetchingQueue = true;
				spotifyHandler.api.getPlaylistTracks(id, {offset: offset}, spotifyHandler.handleFetchedTracks);
			}
			else if (type == "artist") {
				spotifyHandler.fetchingQueue = true;
				spotifyHandler.api.getArtistTopTracks(id, "from_token", {}, spotifyHandler.handleFetchedTracks);
			}
			else if (type == "library" && id == "library") {
				spotifyHandler.fetchingQueue = true;
				spotifyHandler.api.getMySavedTracks({offset: offset, limit: 50, market: "from_token"}, spotifyHandler.handleFetchedTracks);
			}
			else {
				spotifyHandler.dom.queueButton.disabled = true;
				console.log("Queue cannot be retrieved for type " + type);
			}
		}
		else {
			console.warn("Already fetching queue!");
		}
	},

	handleFetchedTracks: function(err, data) {
		spotifyHandler.fetchingQueue = false;
		spotifyHandler.dom.queueButton.disabled = false;
		if (err) {
			console.error(err);
		}
		else {
			console.log("Queue retrieved", data);
			if (data.items) {
				spotifyHandler.addQueueTracks(data.items, false);
				spotifyHandler.queueOffset += data.items.length;
			}
			else if (data.tracks) {
				spotifyHandler.addQueueTracks(data.tracks, true);
				spotifyHandler.queueOffset += data.tracks.length;
			}
			spotifyHandler.queueTotal = data.total;
		}
	},

	createTrackItem: function(tempTrack, doCover, inCurrentContext) {
		var trackElem = document.createElement("li");
		var tempArtists = [];
		trackElem.className = "queue-item";
		trackElem.setAttribute("data-uri", tempTrack.uri);
		if (inCurrentContext) {
			trackElem.setAttribute("data-context", "spotify:"+spotifyHandler.lastQueueType+":"+spotifyHandler.lastQueueId);
		}
		else {
			trackElem.setAttribute("data-context", tempTrack.album.uri);
		}
		trackElem.setAttribute("onclick", "spotifyHandler.playContext(this.getAttribute('data-context'), this.getAttribute('data-uri'));");
		tempArtists = [];
		for (var j = 0; j < tempTrack.artists.length; j++) {
			tempArtists.push(stripTags(tempTrack.artists[j].name));
		}
		trackElem.innerHTML = (doCover ? '<div class="queue-item-cover"><img src="'+(tempTrack.album.images.length > 0 ? tempTrack.album.images.pop().url : 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')+'"></div>': '<div class="queue-item-cover"><span>'+(tempTrack.disc_number > 1 ? tempTrack.disc_number+'-' : '')+tempTrack.track_number+'</span></div>')+'<div class="queue-item-metadata"><div class="queue-item-name">'+stripTags(tempTrack.name)+'</div><div class="queue-item-artist">'+tempArtists.join(', ')+'</div></div>';
		spotifyHandler.dom.queue.appendChild(trackElem);
		return (trackElem);
	},

	addQueueTracks: function(tracks, doCover) {
		var tempTrack = {};
		for (var i = 0; i < tracks.length; i++) {
			
			tempTrack = tracks[i];
			if ("track" in tempTrack) {
				tempTrack = tempTrack.track;
				doCover = true;
			}
			if (tempTrack.uri != null && tempTrack.uri.indexOf(":local:") == -1) {
				spotifyHandler.dom.queue.appendChild(spotifyHandler.createTrackItem(tempTrack, doCover, true));
			}
		}
	},

	playContext: function(contextUri, trackUri) {
		if (trackUri == null) {
			spotifyHandler.api.play({
				context_uri: contextUri
			});
		}
		else if (contextUri != null && contextUri != "spotify:library:library") {
			spotifyHandler.api.play({
				context_uri: contextUri,
				offset: {
					uri: trackUri
				}
			});
		}
		else {
			// workaround for missing context for user's library
			// only plays tracks fetched so far... but it's better than nothing
			var tempUris = [];
			for (var i = 0; i < spotifyHandler.dom.queue.children.length; i++) {
				tempUris.push(spotifyHandler.dom.queue.children[i].getAttribute("data-uri"));
			}
			spotifyHandler.api.play({
				uris: tempUris,
				offset: {
					uri: trackUri
				}
			});
		}
	},

	startPlaySession: function(deviceId) {
		spotifyHandler.api.play({
			device_id: deviceId
		}, function(err, data) {
			if (err) {
				console.error(err);
				alert("Could not start playback due to an error ("+err.status+"). You'll have to start it yourself, on the device you clicked on.");
			}
		});
	},

	fetchingPlaylists: false,
	playlistsTotal: undefined,
	playlistsOffset: 0,
	firstAlbumFetched: false,
	loadLibrary: function() {
		spotifyHandler.dom.library.innerHTML = "";
		spotifyHandler.dom.library.appendChild(spotifyHandler.createDividerItem("Playlists"));
		spotifyHandler.playlistsOffset = 0;
		spotifyHandler.playlistsTotal = undefined;
		spotifyHandler.fetchPlaylists(0);
	},

	fetchPlaylists: function(offset) {
		if (spotifyHandler.fetchingPlaylists != true) {
			spotifyHandler.fetchingPlaylists = true;
			if (offset < spotifyHandler.playlistsTotal || (offset == 0 && spotifyHandler.playlistsTotal == undefined)) {
				spotifyHandler.api.getUserPlaylists({offset: offset, limit: 50}, spotifyHandler.handleFetchedPlaylists);
			}
			else {
				if (!spotifyHandler.firstAlbumFetched) {
					spotifyHandler.dom.library.appendChild(spotifyHandler.createDividerItem("Albums"));
					spotifyHandler.firstAlbumFetched = true;
				}
				offset = offset - spotifyHandler.playlistsTotal;
				if (offset >= 0) {
					spotifyHandler.api.getMySavedAlbums({offset: offset, limit: 50, country: "from_token"}, spotifyHandler.handleFetchedPlaylists);
				}
			}
		}
		else {
			console.warn("Already fetching playlists!");
		}
	},

	handleFetchedPlaylists: function(err, data) {
		spotifyHandler.fetchingPlaylists = false;
		if (err) {
			console.error(err);
		}
		else {
			console.log("Playlists or albums fetched", data);
			spotifyHandler.addPlaylists(data.items);
			spotifyHandler.playlistsOffset += data.items.length;
			if (data.href.indexOf("me/albums") == -1) {
				spotifyHandler.playlistsTotal = data.total;
			}
			else if (data.offset == data.total) {
				// workaround to stop fetching albums from library once all have been fetched
				spotifyHandler.fetchingPlaylists = true;
			}
		}
	},

	createPlaylistOrAlbumItem: function(tempData) {
		playlistElem = document.createElement("li");
		playlistElem.className = "queue-item";
		playlistElem.setAttribute("data-uri", tempData.uri);
		tempArtists = [];
		if ("artists" in tempData) {
			for (var j = 0; j < tempData.artists.length; j++) {
				tempArtists.push(stripTags(tempData.artists[j].name));
			}
		}
		playlistElem.setAttribute("onclick", "spotifyHandler.playContext(this.getAttribute('data-uri'), null); pageHandler.showPage('playerpage');");
		playlistElem.innerHTML = '<div class="queue-item-cover"><img src="'+(tempData.images.length > 0 ? tempData.images.pop().url : 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')+'"></div><div class="queue-item-metadata"><div class="queue-item-name">'+stripTags(tempData.name)+'</div><div class="queue-item-artist">'+("artists" in tempData ? tempArtists.join(", ") : 'by '+stripTags(tempData.owner.display_name))+'</div></div>';
		return (playlistElem);
	},

	addPlaylists: function(data) {
		for (var i = 0; i < data.length; i++) {
			tempData = data[i];
			if ("album" in tempData) {
				tempData = tempData.album;
			}
			spotifyHandler.dom.library.appendChild(spotifyHandler.createPlaylistOrAlbumItem(tempData));
		}
	},

	createDividerItem: function(content) {
		divider = document.createElement("li");
		divider.className = "queue-item divider";
		divider.innerHTML = content;
		return (divider);
	},

	searchReq: null,
	search: function(q) {
		if (spotifyHandler.searchReq != null) {
			spotifyHandler.searchReq.abort();
		}
		if (q.trim() != "")
		{
			spotifyHandler.searchReq = spotifyHandler.api.search(q.trim(), ["track", "album", "playlist"], {offset: 0, limit: 12, market: "from_token"});
			spotifyHandler.searchReq.then(function(data) {
				console.log("Search results are in", data);
				spotifyHandler.dom.search.innerHTML = "";
				var anyResults = false;
				if (data.tracks.items.length > 0) {
					spotifyHandler.dom.search.appendChild(spotifyHandler.createDividerItem("Tracks"));
					for (var i = 0; i < data.tracks.items.length; i++) {
						spotifyHandler.dom.search.appendChild(spotifyHandler.createTrackItem(data.tracks.items[i], true, false));
					}
					anyResults = true;
				}
				if (data.albums.items.length > 0) {
					spotifyHandler.dom.search.appendChild(spotifyHandler.createDividerItem("Albums"));
					for (var i = 0; i < data.albums.items.length; i++) {
						spotifyHandler.dom.search.appendChild(spotifyHandler.createPlaylistOrAlbumItem(data.albums.items[i], true));
					}
					anyResults = true;
				}
				if (data.playlists.items.length > 0) {
					spotifyHandler.dom.search.appendChild(spotifyHandler.createDividerItem("Playlists"));
					for (var i = 0; i < data.playlists.items.length; i++) {
						spotifyHandler.dom.search.appendChild(spotifyHandler.createPlaylistOrAlbumItem(data.playlists.items[i], true));
					}
					anyResults = true;
				}
				if (!anyResults) {
					spotifyHandler.dom.search.appendChild(spotifyHandler.createDividerItem("No results found for \""+stripTags(q.trim())+"\""));
				}
			}, function(err) {
				// console.error(err);
			});
		}
		else {
			spotifyHandler.dom.search.innerHTML = "";
		}
	},

	init: function() {
		document.getElementById("signinbtn").addEventListener("click", spotifyHandler.signIn);

		spotifyHandler.dom.playerPage = document.getElementById("playerpage");
		spotifyHandler.dom.playingFrom = document.getElementById("playing-from");
		spotifyHandler.dom.playingFromName = document.getElementById("playing-from-name");
		spotifyHandler.dom.artwork = document.getElementById("artwork");
		spotifyHandler.dom.title = document.getElementById("title");
		spotifyHandler.dom.artist = document.getElementById("artist");
		spotifyHandler.dom.likeButton = document.getElementById("like-button");
		spotifyHandler.dom.playbackTime = document.getElementById("playback-time");
		spotifyHandler.dom.durationTime = document.getElementById("duration-time");
		spotifyHandler.dom.likeButton = document.getElementById("like-button");
		spotifyHandler.dom.shuffleButton = document.getElementById("shuffle-button");
		spotifyHandler.dom.previousButton = document.getElementById("previous-button");
		spotifyHandler.dom.playPauseButton = document.getElementById("play-pause-button");
		spotifyHandler.dom.nextButton = document.getElementById("next-button");
		spotifyHandler.dom.repeatButton = document.getElementById("repeat-button");
		spotifyHandler.dom.devicesButton = document.getElementById("devices-button");
		spotifyHandler.dom.queuePage = document.getElementById("queuepage");
		spotifyHandler.dom.queueButton = document.getElementById("queue-button");
		spotifyHandler.dom.queue = document.getElementById("queue");
		spotifyHandler.dom.contextName = document.getElementById("contextname");
		spotifyHandler.dom.deviceListHolder = document.getElementById("devicelist-holder");
		spotifyHandler.dom.deviceList = document.getElementById("devicelist");
		spotifyHandler.dom.discoverSpinner = document.getElementById("discoverspinner");
		spotifyHandler.dom.discoverListHolder = document.getElementById("discoverlist-holder");
		spotifyHandler.dom.discoverList = document.getElementById("discoverlist");
		spotifyHandler.dom.volumebar = document.getElementById("volumebar");
		spotifyHandler.dom.listeningOn = document.getElementById("listeningon");
		spotifyHandler.dom.listeningOnIcon = document.getElementById("listeningon-icon");
		spotifyHandler.dom.themeColor = document.querySelector("meta[name=theme-color]");
		spotifyHandler.dom.library = document.getElementById("library");
		spotifyHandler.dom.libraryPage = document.getElementById("librarypage");
		spotifyHandler.dom.search = document.getElementById("search");
		spotifyHandler.dom.searchPage = document.getElementById("searchpage");
		spotifyHandler.dom.searchBar = document.getElementById("searchbar");
		window.addEventListener("resize", spotifyHandler.fixArtSize);
		spotifyHandler.dom.artwork.addEventListener("loadstart", function(event) {
			spotifyHandler.dom.playerPage.style.background = null;
			spotifyHandler.dom.themeColor.setAttribute("content", "#1DB954");
		});
		spotifyHandler.dom.artwork.addEventListener("load", function(event) {
			spotifyHandler.fixArtSize();
			if (event.target.src.indexOf("data:image/gif;base64") != 0) {
				var vibrant = new Vibrant(event.target);
				var swatches = vibrant.swatches();
				if (swatches.Vibrant != undefined) {
					spotifyHandler.dom.playerPage.style.background = "linear-gradient(rgba("+swatches.Vibrant.rgb.join(",")+",0.7), #15161A 75%)";
					spotifyHandler.dom.themeColor.setAttribute("content", swatches.Vibrant.getHex());
				}
				else if (swatches.Muted != undefined) {
					spotifyHandler.dom.playerPage.style.background = "linear-gradient(rgba("+swatches.Muted.rgb.join(",")+",0.7), #15161A 75%)";
					spotifyHandler.dom.themeColor.setAttribute("content", swatches.Muted.getHex());
				}
				else {
					console.log(swatches);
					spotifyHandler.dom.playerPage.style.background = null;
					spotifyHandler.dom.themeColor.setAttribute("content", "#1DB954");
				}
			}
			else {
				spotifyHandler.dom.playerPage.style.background = null;
				spotifyHandler.dom.themeColor.setAttribute("content", "#1DB954");
			}
		});
		spotifyHandler.dom.playPauseButton.addEventListener("click", function(event) {
			spotifyHandler.dom.playPauseButton.disabled = true;
			if (spotifyHandler.dom.playPauseButton.title == "Pause") {
				spotifyHandler.api.pause({}, function() {
					spotifyHandler.dom.playPauseButton.disabled = false;
					spotifyHandler.dom.playPauseButton.innerHTML = "&#xe038;";
					spotifyHandler.dom.playPauseButton.title = "Play";
					setTimeout(function() {
						spotifyHandler.setCurrentlyPlaying();
					}, 250);
				});
			}
			else {
				spotifyHandler.api.play({}, function() {
					spotifyHandler.dom.playPauseButton.disabled = false;
					spotifyHandler.dom.playPauseButton.innerHTML = "&#xe035;";
					spotifyHandler.dom.playPauseButton.title = "Pause";
					setTimeout(function() {
						spotifyHandler.setCurrentlyPlaying();
					}, 250);
				});
			}
		});
		spotifyHandler.dom.nextButton.addEventListener("click", function(event) {
			spotifyHandler.dom.nextButton.disabled = true;
			spotifyHandler.api.skipToNext({}, function() {
				spotifyHandler.dom.nextButton.disabled = false;
				setTimeout(function() {
					spotifyHandler.setCurrentlyPlaying();
				}, 250);
			});
		});
		spotifyHandler.dom.previousButton.addEventListener("click", function(event) {
			spotifyHandler.dom.previousButton.disabled = true;
			spotifyHandler.api.skipToPrevious({}, function() {
				spotifyHandler.dom.previousButton.disabled = false;
				setTimeout(function() {
					spotifyHandler.setCurrentlyPlaying();
				}, 250);
			});
		});
		spotifyHandler.dom.likeButton.addEventListener("click", function(event) {
			spotifyHandler.dom.likeButton.disabled = true;
			if (spotifyHandler.dom.likeButton.getAttribute("data-liked") == "false") {
				spotifyHandler.api.addToMySavedTracks([spotifyHandler.lastTrackId], {}, function(err, data) {
					if (err) {
						console.error(err);
					}
					else {
						spotifyHandler.dom.likeButton.disabled = false;
						spotifyHandler.dom.likeButton.innerHTML = "&#xe87d;";
						spotifyHandler.dom.likeButton.style.color = "#1DB954";
						spotifyHandler.dom.likeButton.title = "Remove from liked songs";
						spotifyHandler.dom.likeButton.setAttribute("data-liked", "true");
					}
				});
			}
			else {
				spotifyHandler.api.removeFromMySavedTracks([spotifyHandler.lastTrackId], {}, function(err, data) {
					if (err) {
						console.error(err);
					}
					else {
						spotifyHandler.dom.likeButton.disabled = false;
						spotifyHandler.dom.likeButton.innerHTML = "&#xe87e;";
						spotifyHandler.dom.likeButton.style.color = null;
						spotifyHandler.dom.likeButton.title = "Add to liked songs";
						spotifyHandler.dom.likeButton.setAttribute("data-liked", "false");
					}
				});
			}
		});
		spotifyHandler.dom.devicesButton.addEventListener("click", function(event) {
			pageHandler.showPage("devicespage");
		});
		spotifyHandler.dom.queueButton.addEventListener("click", function(event) {
			pageHandler.showPage("queuepage");
		});
		spotifyHandler.dom.shuffleButton.addEventListener("click", function(event) {
			spotifyHandler.dom.shuffleButton.disabled = true;
			spotifyHandler.api.setShuffle(!spotifyHandler.lastPlaybackStatus.shuffle_state, {}, function(err, data) {
				spotifyHandler.dom.shuffleButton.disabled = false;
				if (err) {
					console.error(err);
				}
				else {
					setTimeout(function() {
						spotifyHandler.setCurrentlyPlaying();
					}, 250);
				}
			});
		});
		spotifyHandler.dom.repeatButton.addEventListener("click", function(event) {
			spotifyHandler.dom.repeatButton.disabled = true;
			var newState = {
				off: "context",
				context: "track",
				track: "off"
			};
			spotifyHandler.api.setRepeat(newState[spotifyHandler.lastPlaybackStatus.repeat_state], {}, function(err, data) {
				spotifyHandler.dom.repeatButton.disabled = false;
				if (err) {
					console.error(err);
				}
				else {
					setTimeout(function() {
						spotifyHandler.setCurrentlyPlaying();
					}, 250);
				}
			});
		});

		spotifyHandler.dom.queuePage.addEventListener("scroll", function(event) {
			if (event.target.offsetHeight + event.target.scrollTop + 1280 >= event.target.scrollHeight && spotifyHandler.fetchingQueue != true && spotifyHandler.queueOffset < spotifyHandler.queueTotal) {
				console.log("Scrolled near the end of queue, fetching more tracks");
				spotifyHandler.fetchQueueTracks(spotifyHandler.lastQueueType, spotifyHandler.lastQueueId, spotifyHandler.queueOffset);
			}
		});

		spotifyHandler.dom.libraryPage.addEventListener("scroll", function(event) {
			if (event.target.offsetHeight + event.target.scrollTop + 1280 >= event.target.scrollHeight && spotifyHandler.fetchingPlaylists != true) {
				console.log("Scrolled near the end of library, fetching more playlists");
				spotifyHandler.fetchPlaylists(spotifyHandler.playlistsOffset);
			}
		});

		spotifyHandler.dom.searchBar.addEventListener("input", function(event) {
			spotifyHandler.search(event.target.value);
		});

		if ('mediaSession' in navigator)
		{
			navigator.mediaSession.metadata = new MediaMetadata({});
			navigator.mediaSession.setActionHandler('play', spotifyHandler.api.play);
			navigator.mediaSession.setActionHandler('pause', spotifyHandler.api.pause);
			navigator.mediaSession.setActionHandler('nexttrack', spotifyHandler.api.skipToNext);
			navigator.mediaSession.setActionHandler('previoustrack', spotifyHandler.api.skipToPrevious);
			navigator.mediaSession.playbackState = "none";
		}

		if (window.location.hash.length > 0)
		{
			var hash = {};
			var tempHash = window.location.hash.substring(1).split("&");
			window.location.hash = "";
			for (var i = 0; i < tempHash.length; i++) {
				hash[tempHash[i].split("=")[0]] = tempHash[i].split("=")[1];
			}
			if ("access_token" in hash && parseInt(hash["state"]) == state) {
				if (getCookie("spat") != hash["access_token"]) {
					setCookie("spat", hash["access_token"]);
					spotifyHandler.expires = new Date().getTime() + (parseInt(hash["expires_in"]) * 1000);
					setCookie("spex", spotifyHandler.expires);
				}
				else {
					spotifyHandler.expires = parseInt(getCookie("spex"));
				}
				setInterval(spotifyHandler.checkAccessToken, 1000);
				setInterval(spotifyHandler.refreshDevices, 5000);
				setInterval(spotifyHandler.setCurrentlyPlaying, 1000);
				setTimeout(function() {
					setInterval(function() {
						if (spotifyHandler.lastPlaybackStatus.is_playing) {
							progressBar.setValue(((spotifyHandler.lastPlaybackStatus.progress_ms + 500) / spotifyHandler.lastPlaybackStatus.item.duration_ms) * 100);
						}
					}, 1000);
				}, 500);
				spotifyHandler.api.setAccessToken(hash["access_token"]);
				pageHandler.showPage("playerpage");
				spotifyHandler.setCurrentlyPlaying();
				spotifyHandler.refreshDevices();
				spotifyHandler.loadLibrary();
			}
			else if ("error" in hash && parseInt(hash["state"]) == state) {
				if (hash["error"] == "access_denied") {

				}
				else {
					alert("An error occurred connecting to your Spotify account: " + hash["error"]);
				}
				pageHandler.showPage("signinpage");
			}
			else {
				alert("Something went wrong connecting your Spotify account. Please try again.");
				pageHandler.showPage("signinpage");
			}
		}
		else if (getCookie("spat") != null) {
			console.log("No hash present, but we might be able to sign in automatically, since a previous access token was found.");
			spotifyHandler.signIn();
		}
		else {
			pageHandler.showPage('signinpage');
		}
	}
};</script>
	</head>
	<body onload="spotifyHandler.init();">
		<div class="page active" id="loadingpage">
			<div id="loading" style="display: table; width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px;">
				<div style="display: table-cell; vertical-align: middle;">
					<div style="margin-left: auto; margin-right: auto; text-align: center;">
						<div class="spinner"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="page" id="signinpage">
			<h1 id="welcome">Welcome to the Spotify Web Controller</h1>
			<p>You have to sign in with your Spotify account in order to control playback.</p>
			<button class="bigbutton" id="signinbtn">Sign in with Spotify</button>
			<p class="disclaimer"><small>This website uses cookies to store preferences and required user data. By clicking above button, we take that to mean that you accept their use.</small></p>
			<p class="disclaimer footer"><small>This web application is <b>not</b> owned by Spotify AB. It was instead built by <a href="https://freekb.es/">Freek Bes</a> using the official <a href="https://developer.spotify.com/documentation/web-api/">Spotify Web API</a>.</small></p>
		</div>
		<div class="page" id="discoverpage">
			<div style="display: table; width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px;">
				<div style="display: table-cell; vertical-align: middle;">
					<h2>Looking for instances of Spotify...</h2>
					<p id="discover-disclaimer" class="disclaimer">Open Spotify on your computer, smartphone, or anything else. You will be able to control playback here once you've done so.</p>
					<div id="discoverspinner" class="spinner"></div>
					<div id="discoverlist-holder" style="display: none;">
						<div class="selectdevice">Which device would you like to use?</div>
						<ul id="discoverlist"></ul>
					</div>
				</div>
			</div>
		</div>
		<div class="page" id="devicespage">
			<div id="listeningon-holder">
				<div id="listeningon-icon" class="material-icons">&#xe30a;</div>
				<div id="listeningon-title">Listening on</div>
				<div id="listeningon"></div>
			</div>
			<div id="devicelist-holder">
				<div class="selectdevice">Select a device</div>
				<ul id="devicelist"></ul>
			</div>
			<div id="volumebar-holder">
				<div id="volumebar-icon" class="material-icons">&#xe050;</div><input id="volumebar" type="range" min="0" max="100" value="50" step="1" title="Volume" />
			</div>
			<button id="devicespageclose-button" class="material-icons close-button" onclick="pageHandler.showPage('playerpage');" title="Close">&#xe5cd;</button>
		</div>
		<div class="page" id="queuepage">
			<h2 id="contextname" class="list-header"></h2>
			<div id="queue-holder">
				<ul id="queue" class="tracklist"></ul>
			</div>
			<button id="queuepageclose-button" class="material-icons close-button" onclick="pageHandler.showPage('playerpage');" title="Close">&#xe5cd;</button>
		</div>
		<div class="page" id="librarypage">
			<h2 class="list-header">Playlists &amp; albums</h2>
			<div id="library-holder">
				<ul id="library" class="tracklist"></ul>
			</div>
			<button id="librarypageclose-button" class="material-icons close-button" onclick="pageHandler.showPage('playerpage');" title="Close">&#xe5cd;</button>
		</div>
		<div class="page" id="searchpage">
			<h2 class="list-header">Search</h2>
			<div id="search-holder">
				<div id="searchbar-wrapper">
					<input type="text" id="searchbar" placeholder="Search Spotify" />
				</div>
				<ul id="search" class="tracklist"></ul>
			</div>
			<button id="searchpageclose-button" class="material-icons close-button" onclick="pageHandler.showPage('playerpage');" title="Close">&#xe5cd;</button>
		</div>
		<div class="page" id="playerpage">
			<div id="topbar">
				<button id="library-button" class="material-icons" onclick="pageHandler.showPage('librarypage');" title="View your playlists and saved albums">&#xe5cf;</button>
				<div id="playing-from-holder">
					<div id="playing-from"></div>
					<div id="playing-from-name"></div>
				</div>
				<button id="search-button" class="material-icons" onclick="pageHandler.showPage('searchpage');" title="Search Spotify">&#xe8b6;</button>
			</div>
			<div id="art-holder">
				<img id="artwork" crossOrigin="anonymous" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" />
			</div>
			<div id="below-art-holder">
				<div id="metadata-holder-holder">
					<div id="metadata-holder">
						<div id="title"></div>
						<div id="artist"></div>
					</div>
					<button class="material-icons" id="like-button" title="Add to liked songs" data-liked="false">&#xe87e;</button>
				</div>
				<div id="seekbar-holder">
					<div id="progressbar-outer">
						<div class="progressbar-inner" id="barbackground"></div>
						<div class="progressbar-inner" id="bufferbar"></div>
						<div class="progressbar-inner" id="progressbar"></div>
					</div>
					<div id="times"><span id="playback-time"></span><span id="duration-time"></span></div>
				</div>
				<div id="controls-holder">
					<button class="material-icons side-button" id="shuffle-button" title="Shuffle">&#xe043;</button>
					<button class="material-icons skip-button" id="previous-button" title="Previous">&#xe045;</button>
					<button class="material-icons main-button" id="play-pause-button" title="Play">&#xe038;</button>
					<button class="material-icons skip-button" id="next-button" title="Next">&#xe044;</button>
					<button class="material-icons side-button" id="repeat-button" title="Repeat">&#xe040;</button>
				</div>
				<div id="bottombar">
					<button class="material-icons bar-button" id="devices-button" title="Available devices" data-curdevice="">&#xe32e;</button>
					<button class="material-icons bar-button" id="queue-button" title="Queue" disabled>&#xe05f;</button>
				</div>
			</div>
		</div>
		<script>var progressBar = {
	elemOuter: document.getElementById("progressbar-outer"),
	elemInner: document.getElementById("progressbar"),
	buffer: document.getElementById("bufferbar"),
	value: 0,
	bufferValue: 0,
	hovering: false,
	firstSeek: false,
	
	setValue: function(value) {
		if (value < 0) {
			value = 0;
		}
		else if (value > 100) {
			value = 100;
		}
		
		progressBar.value = value;
		progressBar.elemInner.style.width = value+"%";
		progressBar.elemInner.setAttribute("value", value);
	},
	
	getValue: function() {
		return progressBar.value;
	},
	
	setValueBuffer: function(value) {
		if (value < 0) {
			value = 0;
		}
		else if (value > 100) {
			value = 100;
		}
		
		progressBar.bufferValue = value;
		progressBar.buffer.style.width = value+"%";
		progressBar.buffer.setAttribute("value", value);
		
		if (value >= 100) {
			progressBar.buffer.style.backgroundColor = "rgba(0,0,0,0)";
		}
		else {
			progressBar.buffer.style.backgroundColor = null;
		}
	},
	
	progressMouseEnter: function(e) {
		e=e || window.event;
		if ((e.which == 1 || e.type == "touchstart")) {
			progressBar.firstSeek = true;
			// spotifyHandler.api.pause();
			progressBar.hovering = true;
			progressBar.elemInner.style.transition = "none";
			$(progressBar.elemInner).addClass("hovering");
			window.addEventListener("mousemove", progressBar.progressMouseMove);
			window.addEventListener("touchmove", progressBar.progressMouseMove);
			window.addEventListener("mouseup", progressBar.progressMouseLeave);
			window.addEventListener("touchend", progressBar.progressMouseLeave);
			window.addEventListener("touchcancel", progressBar.progressMouseLeave);
			
			/* Cursor Styling */
			var css = '* { cursor: inherit !important; } body { cursor: w-resize !important; }',
			head = document.head || document.getElementsByTagName('head')[0],
			style = document.createElement('style');
			style.type = 'text/css';
			style.id = 'cursorstyling';
			if (style.styleSheet){
				style.styleSheet.cssText = css;
			}
			else {
				style.appendChild(document.createTextNode(css));
			}
			head.appendChild(style);
			progressBar.progressMouseMoveCalc(e);
		}
	},
	
	pauseEvent: function(e){
		if(e.stopPropagation) e.stopPropagation();
		if(e.preventDefault) e.preventDefault();
		e.cancelBubble=true;
		e.returnValue=false;
		return false;
	},

	
	progressMouseMove: function(e) {
		e=e || window.event;
		if (e.type != "touchstart" && e.type != "touchmove" && e.type != "touchend") {
			progressBar.pauseEvent(e);			// stop selecting and moving text on page
		}
		progressBar.progressMouseMoveCalc(e);
	},
	
	progressMouseMoveCalc: function(e) {
		var progressOffset = $("#progressbar-outer").offset();
		var progressOffsetRight = (document.body.clientWidth - ($("#progressbar-outer").offset().left + $("#progressbar-outer").outerWidth()));
		var progressOffsetLeft = progressOffset.left;
		var progressBorderWidth = ($("#progressbar-outer").outerWidth() - $("#progressbar-outer").innerWidth()) / 2;
		var maxX = ($("#progressbar-outer").offset().left + $("#progressbar-outer").outerWidth());
		var minX = progressOffset.left;
		if (e.type == "touchstart" || e.type == "touchmove" || e.type == "touchend") {
			var x = e.changedTouches[0].pageX;
			var y = e.changedTouches[0].pageY;
		}
		else {
			var x = e.clientX;
			var y = e.clientY;
		}
		
		// add scrollbar position to x to fix bugs when scrolled a bit to the right of the page
		if (window.pageXOffset > 0) {
			x = x + window.pageXOffset;
		}
		else if (document.body.scrollLeft > 0) {
			x = x + document.body.scrollLeft;
		}
		else if (document.documentElement.scrollLeft > 0) {
			x = x + document.documentElement.scrollLeft;
		}
	
		// console.log("x: " + x + "\nminX: " + minX + "\nmaxX: " + maxX);
		
		if (x <= minX) {
			progressBar.progressMouseSet(0);
		}
		else if (x >= maxX) {
			progressBar.progressMouseSet(100);
		}
		else {
			var progressPerc = ((x - progressOffsetLeft - progressBorderWidth) / ($("#progressbar-outer").innerWidth())) * 100;
			progressBar.progressMouseSet(progressPerc);
		}
	},
	
	progressMouseSet: function(val) {
		if (spotifyHandler.duration != 0) {
			progressBar.setValue(val);
			
			var timeToBeSet = (progressBar.getValue() / 100) * spotifyHandler.duration;
			spotifyHandler.updateTimes(timeToBeSet, spotifyHandler.duration);
		}
	},
	
	progressMouseLeave: function(e) {
		progressBar.hovering = false;
		progressBar.elemInner.style.transition = null;
		window.removeEventListener("mousemove", progressBar.progressMouseMove);
		window.removeEventListener("touchmove", progressBar.progressMouseMove);
		window.removeEventListener("mouseup", progressBar.progressMouseLeave);
		window.removeEventListener("touchend", progressBar.progressMouseLeave);
		window.removeEventListener("touchcancel", progressBar.progressMouseLeave);
		$("#cursorstyling").remove();
		$(progressBar.elemInner).removeClass("hovering");
		progressBar.progressMouseMoveCalc(e);
		spotifyHandler.api.seek(Math.floor((progressBar.getValue() / 100) * (spotifyHandler.duration * 1000)), {});
		// spotifyHandler.api.play();
		setTimeout(function() {
			spotifyHandler.setCurrentlyPlaying();
		}, 250);
	},
	
	init: function() {
		progressBar.elemOuter.addEventListener("mousedown", progressBar.progressMouseEnter);
		progressBar.elemOuter.addEventListener("touchstart", progressBar.progressMouseEnter);
	}
};

progressBar.init();</script>
		<script>
			window.onbeforeunload = function(e) {
				pageHandler.showPage("loadingpage");
			};
			var changingVolume = false;
			document.getElementById("volumebar").addEventListener("input", function(event) {
				spotifyHandler.setVolume(event.target.value, true);
			});
			document.getElementById("volumebar").addEventListener("mousedown", function(event) {
				changingVolume = true;
			});
			document.getElementById("volumebar").addEventListener("touchstart", function(event) {
				changingVolume = true;
			});
			document.getElementById("volumebar").addEventListener("mouseup", function(event) {
				spotifyHandler.setVolume(event.target.value, false);
				changingVolume = false;
			});
			document.getElementById("volumebar").addEventListener("touchend", function(event) {
				spotifyHandler.setVolume(event.target.value, false);
				changingVolume = false;
			});
		</script>
	</body>

<!-- Mirrored from freekb.es/spotify/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 28 May 2025 14:55:56 GMT -->
</html>
